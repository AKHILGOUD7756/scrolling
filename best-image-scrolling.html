<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Infinite Slider</title>

<!-- GSAP -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

<!-- Lodash (for debounce) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>

<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  background-color: #000;
  /*overflow-x: hidden;*/
}

/* ===================== SLIDER ===================== */

.slider-container {
  width: 100%;
  height: 100vh;
  overflow: hidden;
  position: relative;
}

.slider-container::after {
  content: "";
  position: absolute;
  left: 0;
  top: 50%;
  height: 1px;
  width: 100%;
  background-color: rgba(255,255,255,0.05);
  z-index: -1;
}

.slider {
  display: flex;
  flex-wrap: nowrap;
  width: max-content;
}

.slider-item {
  width: 50vw;
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  user-select: none;
  overflow: hidden;
}

.slider-item__inner {
  width: 90%;
  position: relative;
  padding-top: 52.25%;
  overflow: hidden;
  border-radius: 3px;
}

.slider-item__inner img {
  width: 100%;
  height: 100%;
  position: absolute;
  inset: 0;
  object-fit: cover;
  filter: grayscale(100%);
  transition: filter 0.2s ease-in-out;
}

.slider-item__inner:hover img {
  filter: grayscale(10%);
}
section{
  height: 100vh;
}
</style>
</head>

<body>
<section>
  
  
</section>
<div class="slider-container js-slider-container">
  <div class="slider js-slider">

    <!-- SLIDES -->
    <div class="slider-item js-slider-item"><div class="slider-item__inner"><img src="https://images.unsplash.com/photo-1644695461155-5ab5a3378d1f?q=80&w=800" /></div></div>
    <div class="slider-item js-slider-item"><div class="slider-item__inner"><img src="https://images.unsplash.com/photo-1646498820707-7fac1859874c?q=80&w=800" /></div></div>
    <div class="slider-item js-slider-item"><div class="slider-item__inner"><img src="https://images.unsplash.com/photo-1645003320730-396433b490df?q=80&w=800" /></div></div>
    <div class="slider-item js-slider-item"><div class="slider-item__inner"><img src="https://images.unsplash.com/photo-1646019491029-790ca0ff53de?q=80&w=800" /></div></div>
    <div class="slider-item js-slider-item"><div class="slider-item__inner"><img src="https://images.unsplash.com/photo-1644704170910-a0cdf183649b?q=80&w=800" /></div></div>
    <div class="slider-item js-slider-item"><div class="slider-item__inner"><img src="https://images.unsplash.com/photo-1646405738217-a197bf3b9e84?q=80&w=800" /></div></div>

  </div>
</div>
<section>
  
  
</section>
<script>
console.clear()

/* Utils */
const lerp = (a, b, n) => (1 - n) * a + n * b
const qs = (s, o = document) => o.querySelector(s)
const qsa = (s, o = document) => [...o.querySelectorAll(s)]

let wh = window.innerHeight
let ww = window.innerWidth

class InfiniteSlider {
  constructor(el) {
    this.el = el

    this.dom = {
      container: qs('.js-slider'),
      slides: qsa('.js-slider-item')
    }

    this.state = {
      scrolling: false,
      resizing: false,
      direction: null
    }

    this.scroll = {
      current: 0,
      target: 0,
      ease: 0.1,
      last: 0,
      position: 0
    }

    this.init()
  }

  addSections() {
    this.sections = {}

    this.dom.slides.forEach((section, index) => {
      const bounds = section.getBoundingClientRect()

      this.sections[index] = {
        el: section,
        offset: {
          left: bounds.left,
          right: bounds.right
        },
        inView: false
      }
    })
  }

  detectScrolling() {
    this.state.scrolling =
      Math.abs(this.scroll.current - this.scroll.target) >= 0.5
  }

  tick = () => {
    if (this.state.resizing) return

    this.detectScrolling()

    if (!this.state.scrolling) return

    this.scroll.current = lerp(
      this.scroll.current,
      this.scroll.target,
      this.scroll.ease
    )

    const warp = gsap.utils.wrap(
      0,
      -this.dom.container.scrollWidth + ww,
      this.scroll.current
    )

    const velocity = (this.scroll.target - this.scroll.current) / ww

    Object.values(this.sections).forEach(section => {
      const inView =
        -warp > section.offset.left - ww &&
        -warp < section.offset.right

      if (inView) {
        section.el.style.transform =
          `skewX(${velocity * 10}deg) translate3d(${warp}px,0,0)`
        section.el.style.opacity = 1
      } else {
        section.el.style.opacity = 0
      }
    })

    this.scroll.last = this.scroll.current
  }

  onWheel = e => {
    this.scroll.target += e.deltaY
  }

  onResize = () => {
    this.state.resizing = true
    ww = window.innerWidth
    wh = window.innerHeight
    this.addSections()
    this.state.resizing = false
  }

  addEvents() {
    gsap.ticker.add(this.tick)
    window.addEventListener('wheel', this.onWheel)
    window.addEventListener('resize', _.debounce(this.onResize, 200))
  }

  init() {
    this.addSections()
    this.addEvents()
  }
}

new InfiniteSlider(qs('.js-slider'))
</script>

</body>
</html>
